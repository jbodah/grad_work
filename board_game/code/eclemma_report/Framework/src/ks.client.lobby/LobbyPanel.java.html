<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>LobbyPanel.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (Apr 28, 2012 2:01:54 PM)</a> &gt; <a href="../../index.html" class="el_group">Framework</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">ks.client.lobby</a> &gt; <span class="el_source">LobbyPanel.java</span></div><h1>LobbyPanel.java</h1><pre class="source lang-java linenums"><span class="fc" id="L1">package ks.client.lobby;</span>

import java.awt.Color;
import java.awt.Dimension;

import javax.swing.GroupLayout;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.JTextPane;
import javax.swing.ScrollPaneConstants;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JScrollPane;
import javax.swing.text.BadLocationException;
import javax.swing.text.Style;
import javax.swing.text.StyleConstants;
import javax.swing.text.StyledDocument;

import ks.client.controllers.ProcessLobbyInputController;
import ks.client.interfaces.ILobby;
import ks.client.interfaces.IProcessLobbyInput;

/**
 * Inner GUI element that holds the primary graphical entities on the 
 * client side.
 * &lt;p&gt;
 * The intent is for user manager and table managers to be &quot;dropped in&quot; for
 * separation of implementation. This class takes advantage of the GroupLayout
 * layout manager for ease of design.
 * 
 * Significant TextPane adjustments as recommended by Alec Mitnik
 * 
 * @author George Heineman
 */
public class LobbyPanel extends JPanel {

	// keep eclipse happy. 
	private static final long serialVersionUID = 1L;
	
<span class="fc" id="L42">	private JTextField lobbyInput = null;</span>
<span class="fc" id="L43">	private JPanel userManagerGUI = null;</span>
<span class="fc" id="L44">	private JPanel  tableManagerGUI = null;</span>
<span class="fc" id="L45">	private JScrollPane tblScrollPanel = null;</span>
<span class="fc" id="L46">	private JScrollPane userScrollPanel = null;</span>
<span class="fc" id="L47">	private JScrollPane lobbyScrollbarPanel = null;</span>
<span class="fc" id="L48">	private JTextPane lobbyOutput = null;</span>
	
	/** Lobby in which we are enclosed. */
	ILobby lobby;

	/** Default lobby controller (Can be overridden as needed). */
	IProcessLobbyInput defaultLobbyController;
	
	/**
	 * This is the default constructor
	 */
	public LobbyPanel(ILobby lobby) {
<span class="fc" id="L60">		super();</span>
		
<span class="fc" id="L62">		this.lobby = lobby;</span>
<span class="fc" id="L63">		initialize();</span>
		
		// set default lobby controller to use
<span class="fc" id="L66">		defaultLobbyController = new ProcessLobbyInputController(lobby);</span>
<span class="fc" id="L67">	}</span>


	/**
	 * This method initializes this
	 * 
	 * @return void
	 */
	private void initialize() {
<span class="fc" id="L76">		this.setSize(850, 710);</span>
		
		// new GroupLayout idiom in place.
<span class="fc" id="L79">		GroupLayout layout = new GroupLayout(this);</span>
<span class="fc" id="L80">		this.setLayout(layout);</span>
<span class="fc" id="L81">		layout.setAutoCreateGaps(true);</span>
<span class="fc" id="L82">		layout.setAutoCreateContainerGaps(true);</span>

<span class="fc" id="L84">		getTblScrollPanel();</span>
<span class="fc" id="L85">		getUserScrollPanel();</span>
<span class="fc" id="L86">		getLobbyScrollbarPanel();</span>
<span class="fc" id="L87">		getLobbyInput();</span>
		
		// deal here
<span class="fc" id="L90">		layout.setVerticalGroup(layout.createSequentialGroup()</span>
<span class="fc" id="L91">			    .addGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)</span>
<span class="fc" id="L92">			    	.addGroup(layout.createSequentialGroup()</span>
<span class="fc" id="L93">			    		.addComponent(getTblScrollPanel())</span>
<span class="fc" id="L94">			    		.addComponent(getLobbyScrollbarPanel())</span>
<span class="fc" id="L95">			    		.addComponent(getLobbyInput()))</span>
<span class="fc" id="L96">			    	.addComponent(getUserScrollPanel()))</span>
			    	);
		
<span class="fc" id="L99">		layout.setHorizontalGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)</span>
<span class="fc" id="L100">				.addGroup(layout.createSequentialGroup()</span>
<span class="fc" id="L101">					.addGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)</span>
<span class="fc" id="L102">						.addComponent(getTblScrollPanel())</span>
<span class="fc" id="L103">						.addComponent(getLobbyScrollbarPanel())</span>
<span class="fc" id="L104">						.addComponent(getLobbyInput()))</span>
<span class="fc" id="L105">					.addComponent(getUserScrollPanel()))</span>
					);
							
<span class="fc" id="L108">	}</span>

	/** Set alternative lobby controller to use and return old one. */
	public IProcessLobbyInput setLobbyInputController (IProcessLobbyInput ipl) {
<span class="nc" id="L112">		IProcessLobbyInput old = defaultLobbyController;</span>
<span class="nc" id="L113">		defaultLobbyController = ipl;</span>
		
<span class="nc" id="L115">		return old;</span>
	}
	
	/**
	 * return the user manager GUI	
	 */
	JPanel getUserManagerGUI() {
<span class="fc" id="L122">		return userManagerGUI;</span>
	}

	/**
	 * return the table manager GUI
	 */
	JPanel getTableManagerGUI() {
<span class="fc" id="L129">		return tableManagerGUI;</span>
	}

	/**
	 * This method initializes tblScrollPanel	
	 * 	
	 * @return javax.swing.JScrollPane	
	 */
	public JScrollPane getTblScrollPanel() {
<span class="fc bfc" id="L138" title="All 2 branches covered.">		if (tblScrollPanel == null) {</span>
<span class="fc" id="L139">			tblScrollPanel = new JScrollPane();</span>
			// tblScrollPanel.setBounds(0, 0, 496, 428);
<span class="fc" id="L141">			tblScrollPanel.getVerticalScrollBar().setUnitIncrement(10);</span>
<span class="fc" id="L142">			tblScrollPanel.setMinimumSize(new Dimension(496, 88));</span>
<span class="fc" id="L143">			tblScrollPanel.setMaximumSize(new Dimension(496, 428));</span>
<span class="fc" id="L144">			tblScrollPanel.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</span>
		}
<span class="fc" id="L146">		return tblScrollPanel;</span>
	}

	/**
	 * This method initializes userScrollPanel	
	 * 	
	 * @return javax.swing.JScrollPane	
	 */
	public JScrollPane getUserScrollPanel() {
<span class="fc bfc" id="L155" title="All 2 branches covered.">		if (userScrollPanel == null) {</span>
<span class="fc" id="L156">			userScrollPanel = new JScrollPane();</span>
			//userScrollPanel.setBounds(new Rectangle(603, 73, 350, 635));
<span class="fc" id="L158">			userScrollPanel.setMinimumSize(new Dimension(350, 88));</span>
			//userScrollPanel.setMaximumSize(new Dimension(350, 428));
			//userScrollPanel.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_ALWAYS);
			//userScrollPanel.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);

		}
<span class="fc" id="L164">		return userScrollPanel;</span>
	}

	/**
	 * This method initializes lobbyScrollbarPanel	
	 * 	
	 * @return javax.swing.JScrollPane	
	 */
	public JScrollPane getLobbyScrollbarPanel() {
<span class="fc bfc" id="L173" title="All 2 branches covered.">		if (lobbyScrollbarPanel == null) {</span>
<span class="fc" id="L174">			lobbyScrollbarPanel = new JScrollPane();</span>
			//lobbyScrollbarPanel.setBounds(new Rectangle(11, 419, 581, 226));
<span class="fc" id="L176">			lobbyScrollbarPanel.setMaximumSize(new Dimension(496, 1000));</span>
			//lobbyScrollbarPanel.setMinimumSize(new Dimension(496, 130));
			//lobbyScrollbarPanel.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<span class="fc" id="L179">			lobbyScrollbarPanel.setViewportView(getLobbyOutput());</span>
<span class="fc" id="L180">			lobbyScrollbarPanel.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</span>

		}
<span class="fc" id="L183">		return lobbyScrollbarPanel;</span>
	}

	/**
	 * This method initializes lobbyOutput	
	 * 	
	 * @return javax.swing.JTextPane	
	 */
	public JTextPane getLobbyOutput() {
<span class="fc bfc" id="L192" title="All 2 branches covered.">		if (lobbyOutput == null) {</span>
<span class="fc" id="L193">			lobbyOutput = new JTextPane();</span>
<span class="fc" id="L194">			lobbyOutput.setMaximumSize(new Dimension(496, 5));</span>
			
			// not writable directly by user.
<span class="fc" id="L197">			lobbyOutput.setEditable(false);</span>
		}
<span class="fc" id="L199">		return lobbyOutput;</span>
	}
	
	/**
	 * This method initializes lobbyOutput	
	 * 	
	 * @return javax.swing.JTextPane	
	 */
	public JTextField getLobbyInput() {
<span class="fc bfc" id="L208" title="All 2 branches covered.">		if (lobbyInput == null) {</span>
<span class="fc" id="L209">			lobbyInput = new JTextField(80);</span>
<span class="fc" id="L210">			lobbyInput.setMaximumSize(new Dimension(496,24));</span>
			
<span class="fc" id="L212">			lobbyInput.addActionListener(new ActionListener() {</span>

				public void actionPerformed(ActionEvent e) {
<span class="nc" id="L215">					String s = lobbyInput.getText();</span>
<span class="nc" id="L216">					lobbyInput.setText(&quot;&quot;);</span>

<span class="nc" id="L218">					defaultLobbyController.process(s);</span>
					
					// REQUEST to access special controller instead of mine.
					// hand off to the newly constructed controller to process 
					// new ProcessLobbyInputController(lobby).process(s);

<span class="nc" id="L224">				}</span>
				
			});
		}
<span class="fc" id="L228">		return lobbyInput;</span>
	}
	
	/**
	 * Insert a new announcement into the lobby chat
	 * 
	 * @param s
	 */
	public void append(String s) {
<span class="fc" id="L237">		Style style = lobbyOutput.addStyle(&quot;Bold Italic&quot;, null);</span>
<span class="fc" id="L238">		StyleConstants.setItalic(style, true);</span>
		
<span class="fc" id="L240">		StyledDocument doc = lobbyOutput.getStyledDocument();</span>
		
		try {
<span class="fc" id="L243">			doc.insertString(doc.getLength(), s + &quot;\r\n&quot;, style);</span>
<span class="nc" id="L244">		} catch (BadLocationException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L246">			e.printStackTrace();</span>
		}
		
<span class="fc" id="L249">		StyleConstants.setItalic(style, false);</span>
		
<span class="fc" id="L251">		scrollToEnd();		</span>
<span class="fc" id="L252">	}</span>

	/**
	 * Insert a new message into the lobby chat 
	 * 
	 * @param speaker
	 * @param s
	 */
	public void append(String speaker, String s, boolean publicMessage) { // CHANGED!
<span class="nc" id="L261">		Style style = lobbyOutput.addStyle(&quot;Bold Italic Red Blue Purple&quot;, null); // CHANGED!</span>
<span class="nc" id="L262">		StyleConstants.setBold(style, true);</span>
		
<span class="nc" id="L264">		Color defaultTextColor = StyleConstants.getForeground(style);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">		if (lobby.getContext().getUser().equals(speaker)) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">			if (publicMessage) {									// CHANGED!...</span>
<span class="nc" id="L267">				StyleConstants.setForeground(style, Color.RED);</span>
			}
			else {
<span class="nc" id="L270">				StyleConstants.setItalic(style, true);</span>
<span class="nc" id="L271">				StyleConstants.setForeground(style, new Color(128, 0, 255));</span>
			}
		}
<span class="nc bnc" id="L274" title="All 2 branches missed.">		else if (!publicMessage) {</span>
<span class="nc" id="L275">			StyleConstants.setItalic(style, true);</span>
<span class="nc" id="L276">			StyleConstants.setForeground(style, Color.BLUE);</span>
		}															// ...CHANGED!
		
<span class="nc" id="L279">		StyledDocument doc = lobbyOutput.getStyledDocument();</span>
		
		try {
<span class="nc" id="L282">			doc.insertString(doc.getLength(), speaker + &quot;: &quot;, style);</span>
<span class="nc" id="L283">		} catch (BadLocationException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L285">			e.printStackTrace();</span>
		}
		
<span class="nc" id="L288">		StyleConstants.setForeground(style, defaultTextColor);</span>
		
<span class="nc" id="L290">		StyleConstants.setBold(style, false);</span>
		try {
<span class="nc" id="L292">			doc.insertString(doc.getLength(), s + &quot;\r\n&quot;, style);</span>
<span class="nc" id="L293">		} catch (BadLocationException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L295">			e.printStackTrace();</span>
		}
		
<span class="nc" id="L298">		StyleConstants.setItalic(style, false);</span>
		
<span class="nc" id="L300">		scrollToEnd();		</span>
<span class="nc" id="L301">	}</span>
	
	/**
	 * Make sure we can scroll to the end on demand.
	 */
	void scrollToEnd() {
<span class="fc" id="L307">		lobbyOutput.setCaretPosition(lobbyOutput.getDocument().getLength());</span>
<span class="fc" id="L308">	}</span>

	/**
	 * Drop this one in.
	 * 
	 * @param tableManagerGUI
	 */
	public void setTableManagerGUI(JPanel tg) {
<span class="fc" id="L316">		tableManagerGUI = tg;</span>
<span class="fc" id="L317">		tblScrollPanel.setViewportView(tg);</span>
<span class="fc" id="L318">	}</span>


	/**
	 * Drop this one in.
	 * 
	 * @param userManagerGUI
	 */
	public void setUserManagerGUI(JPanel ug) {
<span class="fc" id="L327">		userManagerGUI = ug;</span>
<span class="fc" id="L328">		userScrollPanel.setViewportView(ug);</span>
<span class="fc" id="L329">	}</span>


}  //  @jve:decl-index=0:visual-constraint=&quot;10,10&quot;
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.6.201201232323</span>Merged (Apr 28, 2012 2:01:54 PM)</div></body></html>